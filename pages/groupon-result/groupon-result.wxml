<!--pages/groupon-result/groupon-result.wxml-->

<!--**
 * Project: WooCommerce微信小程序
 * Description: 将WooCommerce商城接入微信小程序
 * Author: 
 * Organization: 
 */-->

<!-- W2W Extension, Name: w2w-products-groupon, Code: grouponResultContent -->

<import src="/templates/groupon-members.wxml" />
<import src="/templates/groupon-rule-popup.wxml" />
<import src="/templates/poster-popup.wxml" />
<import src="/templates/share-popup.wxml" />
<import src="/templates/login-popup.wxml" />
<import src="/templates/nav-bar.wxml" />

<nav-bar custom-style="{{ {backgroundColor:'#fff'} }}">
    <view slot="content" class="nav-bar-wrapper-wrap">
        <template is="nav-bar" data="{{pageTitle, backBtn: true}}"></template>
    </view>
    <view slot="placeholder" style="height:{{NAV_HEIGHT}}"></view>
</nav-bar>

<view wx:if="{{groupon}}" class="container groupon-result">
    <view class="product-block" data-id="{{groupon.product_id}}" bindtap="goGrouponProduct">
        <image class="product-image" src="{{groupon.product_image}}"></image>
        <view class="product-info">
            <view class="product-title-desc">
                <view class="product-title ellipsis">{{groupon.product_name}}</view>
                <view class="product-desc ellipsis ellipsis-2">{{groupon.product_desc}}</view>
            </view>
            <view class="product-price">
                <view class="main-price">
                    <text>{{groupon.product_groupon_price}}</text>
                    <text class="yuan">元</text>
                </view>
                <view class="price-saved">拼团省 {{groupon.product_price_saved}}元</view>
            </view>
        </view>
    </view>
    <view class="result-main">
        <block wx:if="{{groupon.dismiss}}">
            <view class="result-label">
                <image class="groupon-result-img failed}}" src="/images/sorry-main-color.svg"></image>
                <text class="primary-color">已解散</text>
            </view>
            <view class="result-expire">
                <text class="groupon-success-date">管理员于 {{groupon.dismiss}} 解散拼团</text>
            </view>
            <button class="btn btn-primary main-btn" data-id="{{groupon.product_id}}" bindtap="goGrouponProduct">去开新团</button>
        </block>
        <block wx:elif="{{groupon.is_success}}">
            <view class="result-label">
                <image class="groupon-result-img {{groupon.is_grouped_on ? 'success' : 'failed'}}" src="{{groupon.is_grouped_on ? '/images/check.svg' : '/images/sorry-main-color.svg'}}"></image>
                <text class="primary-color">{{groupon.is_grouped_on ? '拼团成功' : '已满员'}}</text>
            </view>
            <view class="result-expire">
                <text class="groupon-success-date">{{groupon.is_grouped_on ? groupon.groupon_success + ' 已达成' : '此团已经够人数啦~去开一个新团吧'}}</text>
            </view>
            <block wx:if="{{!groupon.is_grouped_on}}">
                <button class="btn btn-primary main-btn" data-id="{{groupon.product_id}}" bindtap="goGrouponProduct">去开新团</button>
            </block>
        </block>
        <block wx:else>
            <view class="result-label">
                <text>还差</text>
                <text class="primary-color member-remain">{{groupon.member_remain}}</text>
                <text>人成团</text>
            </view>
            <view class="result-expire">
                <text class="expire-label">{{groupon.is_expired ? '已结束 拼团失败 系统将自动退款' : '距结束'}}</text>
                <view wx:if="{{!groupon.is_expired}}" class="countdown">
                    <text class="countdown-num">{{grouponCountDown.hours}}</text>
                    <text class="countdown-sp">:</text>
                    <text class="countdown-num">{{grouponCountDown.minutes}}</text>
                    <text class="countdown-sp">:</text>
                    <text class="countdown-num">{{grouponCountDown.seconds}}</text>
                </view>
            </view>
            <block wx:if="{{groupon.is_expired}}">
                <button class="btn btn-primary main-btn" data-id="{{groupon.product_id}}" bindtap="goGrouponProduct">去开新团</button>
            </block>
            <block wx:elif="{{groupon.is_grouped_on}}">
                <button class="btn btn-primary main-btn" bindtap="openSharePopup">邀请好友拼单</button>
            </block>
            <block wx:else>
                <button class="btn btn-primary main-btn" bindtap="goGrouponCheckout">我要参团</button>
            </block>
        </block>
    </view>
    <view class="result-detail">
        <template is="groupon-members" data="{{groupon}}"></template>
    </view>
    <view class="popup-btn thin-border thin-border-top" data-id="{{groupon.product_id}}" bindtap="goGrouponProduct">
        <view class="button-main">
            <text class="title">产品</text>
            <text class="content">{{groupon.product_name}}</text>
        </view>
        <view class="go-popup">
            <image src="/images/go_light.svg"></image>
        </view>
    </view>
    <view class="popup-btn thin-border thin-border-top" bindtap="openGrouponRulePopup">
        <view class="button-main">
            <text class="title">玩法</text>
            <text class="content">开团 / 参团 - 邀请好友 - 拼成发货</text>
        </view>
        <view class="go-popup">
            <image src="/images/go_light.svg"></image>
        </view>
    </view>
    <view class="popup-btn thin-border thin-border-top more-product" data-url="/pages/groupon-product-list/groupon-product-list" bindtap="linkTap">
        <view class="button-main">
            <text class="title">更多</text>
            <text class="content">其它拼团产品</text>
        </view>
        <view class="go-popup">
            <image src="/images/go_light.svg"></image>
        </view>
    </view>

    <!-- 拼团规则弹窗开始 -->
    <template is="groupon-rule-popup" data="{{isGrouponRulePopup}}"></template>
    <!-- 拼团规则弹窗结束 -->

    <!-- 分享海报开始 -->
    <template is="poster-popup" data="{{isPosterPopup, posterImage, width: 840, height: 1484}}"></template>
    <!-- 分享海报结束 -->

    <template is="login-popup" data="{{show: isLoginPopup, userInfo}}"></template>
    <template is="share-popup" data="{{isSharePopup}}"></template>
</view>

<!-- W2W Extension, Name: w2w-products-groupon, Code: grouponResultContent -->