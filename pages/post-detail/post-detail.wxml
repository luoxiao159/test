<!--pages/post-detail/post-detail.wxml-->

<!--**
 * Project: WooCommerce微信小程序
 * Description: 将WooCommerce商城接入微信小程序
 * Author: 
 * Organization: 
 */-->

<import src="/templates/nav-bar.wxml" />
<import src="/templates/share-popup.wxml" />
<import src="/templates/poster-popup.wxml" />
<import src="/templates/login-popup.wxml" />

<nav-bar custom-style="{{ {backgroundColor:'#fff'} }}">
    <view slot="content" class="nav-bar-wrapper-wrap">
        <template is="nav-bar" data="{{pageTitle, backBtn: true}}"></template>
    </view>
    <view slot="placeholder" style="height:{{NAV_HEIGHT}}"></view>
</nav-bar>

<view wx:if="{{post != null}}" class="container post-detail">
    <view wx:if="{{post.featured_media.full.url}}">
        <lazy-image src="{{post.featured_media.full.url}}" dynamic-width="{{true}}" width="16" height="9" mode="aspectFill" />
    </view>
    <view class="block first">
        <view class="post-title">{{post.title.rendered}}</view>
        <view class="post-meta header">
            <view class="meta meta-time">
                <text>{{post.date}}</text>
            </view>
        </view>
        <view class="post-content">
            <html2wxml json="{{post.content.rendered}}" showLoading="{{false}}" padding="15" data-type="detail" bindWxmlTagATap="tagATap" bindWxmlVideoPlay="videoPlay" bindWxmlVideoPause="videoPause" bindWxmlPlayVideo="playDetailVideo" bindWxmlReceiveCoupon="receiveCoupon"></html2wxml>
        </view>
        <view class="post-meta footer">
            <view class="meta meta-view">
                <text>阅读 {{post.views}}</text>
            </view>
        </view>
    </view>

    <view class="block share-popup">
        <template is="share-bar"></template>
    </view>

    <view class="block post-comment">
        <view class="post-comment-header">
            <view class="comment-label">精选留言</view>
            <view class="write-comment" bindtap="openCommentPopup">写留言</view>
        </view>
        <block wx:if="{{comments.length > 0}}">
            <view class="comment-list">
                <block wx:for="{{comments}}" wx:key="key">
                    <view class="comment">
                        <view class="comment-avatar">
                            <image src="{{item.avatar}}"></image>
                        </view>
                        <view class="comment-right">
                            <view class="comment-name">{{item.name}}</view>
                            <view class="comment-content">{{item.comment}}</view>
                            <view class="comment-footer">
                                <view class="comment-date">{{item.date_created}}</view>
                            </view>
                        </view>
                    </view>
                </block>
                <view wx:if="{{bottomStyle != 'nomore'}}" class="load-more" bindtap="loadMoreComments">加载更多</view>
            </view>
        </block>
        <block wx:elif="{{comments.length == 0}}">
            <view class="empty-comment">留下你的精彩言论吧！</view>
        </block>
    </view>

    <!-- 评论弹窗开始 -->
    <view class="zan-popup zan-popup--bottom comment-popup {{isCommentPopup ? 'zan-popup--show' : ''}}">
        <view class="zan-popup__mask" bindtap="closeCommentPopup" catchtouchmove="preventTouchMove"></view>
        <view class="zan-popup__container">
            <form report-submit="{{true}}">
                <view class="reply-input-wrapper">
                    <view class="reply-input">
                        <input name="content" confirm-type="send" cursor-spacing="13" bindconfirm="submitReply" placeholder="说点什么吧~" placeholder-class="input-placeholder-thin-gray" value="{{replyInputValue}}" data-name="content" bindblur="inputBlur"></input>
                    </view>
                    <view class="reply-send">
                        <button form-type="submit" bindtap="submitComment">
                            <image src="/images/reply-send.svg"></image>
                        </button>
                    </view>
                </view>
            </form>
        </view>
    </view>
    <!-- 评论弹窗结束 -->

    <!-- 分享海报开始 -->
    <template is="poster-popup" data="{{isPosterPopup, posterImage, width: 600, height: 800}}"></template>
    <!-- 分享海报结束 -->

    <template is="login-popup" data="{{show: isLoginPopup, userInfo}}"></template>
</view>